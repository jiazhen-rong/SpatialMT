% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/HMRF.R
\name{Mstep}
\alias{Mstep}
\title{Maximization Step (M-Step) for HMRF-ICM}
\usage{
Mstep(
  X_j,
  N_j,
  Z_j,
  pi_j0,
  gamma,
  pi_1j,
  neighbor_s_vaf,
  Wc,
  prior_energy = FALSE,
  opt_method = c("optim", "MoM"),
  neighbor_num = 4
)
}
\arguments{
\item{X_j}{Numeric vector of observed variant allele counts for each spatial location.}

\item{N_j}{Numeric vector of total read counts for each spatial location.}

\item{Z_j}{Numeric vector of current latent variable assignments (0 = background, 1 = carrier).}

\item{pi_j0}{Background probability parameter, controlling the baseline variant allele frequency.}

\item{gamma}{Scaling parameter for the neighborhood variant allele frequency effect.}

\item{pi_1j}{Carrier probability parameter, affecting locations labeled as carriers.}

\item{neighbor_s_vaf}{Numeric vector of neighborhood variant allele frequencies.}

\item{Wc}{Numeric vector of weighted cell-type proportions at each location.}

\item{prior_energy}{Logical; if \code{TRUE}, incorporates a prior energy function in parameter estimation.}

\item{opt_method}{Character vector specifying the optimization method.
Can be \code{"optim"} (default, numerical optimization) or \code{"MoM"} (method of moments).}
}
\value{
A list containing the updated parameter estimates:
\describe{
\item{pi_j0_new}{Updated background probability parameter.}
\item{gamma_new}{Updated neighborhood scaling parameter.}
\item{pi_1j_new}{Updated carrier probability parameter.}
}
}
\description{
This function performs the Maximization step in the Expectation-Maximization (EM) algorithm for
Hidden Markov Random Fields (HMRF) using either numerical optimization (\code{optim()})
or alternative estimation methods.
}
\details{
This function updates the model parameters by maximizing the posterior probability.
By default, it uses \code{optim()} with the \code{"L-BFGS-B"} method to find the optimal values
of \eqn{\pi_{j0}}, \eqn{\gamma}, and \eqn{\pi_{1j}} by minimizing the negative log-posterior probability.
If \code{prior_energy = TRUE}, it incorporates a spatial prior energy term.

The method can be extended to include alternative estimation approaches such as
Newton-Raphson (\code{"NR"}) or the Method of Moments (\code{"MoM"}) in future implementations.
}
\examples{
# Example usage:
X_j <- c(10, 5, 8)
N_j <- c(100, 50, 80)
Z_j <- c(0, 1, 0)
neighbor_s_list <- list(c(2,3), c(1,3), c(1,2))
neighbor_s_vaf <- c(0.1, 0.05, 0.08)
Wc <- c(0.2, 0.1, 0.3)

# Run M-step with numerical optimization
updated_params <- Mstep(X_j, N_j, Z_j, pi_j0 = 0.1, gamma = 0.5, pi_1j = 0.5, 
                        neighbor_s_vaf, Wc, prior_energy = FALSE, opt_method = "optim")

print(updated_params)
}
